# 2026-02-12 02:41: Deep Think - JSON Straitjacket & Logic Traps

**Focus:** JSON Straitjacket (JSON 拘束衣) & Logic Traps (逻辑陷阱)

## 1. Feasibility Analysis (可行性分析)

### JSON Straitjacket (JSON 拘束衣)
*   **The Problem:** 端侧小模型（如 Llama-3-8B-q4f16_1 或 Phi-3-mini）通常在指令遵循（Instruction Following）上较弱，尤其是严格格式。
*   **WebGPU Constraint:** WebLLM 依赖 WebGPU。Chrome 支持最好，Safari 初步支持但显存管理较严。如果是 8B 模型，至少需要 4GB+ 显存，这排除了大部分手机用户，仅限桌面端/高性能笔记本。
*   **Parsing Logic:** 传统的 `JSON.parse` 是一票否决制。对于 Arena 来说，这很好。但为了更有趣，我们可能需要“容错解析”来给分（比如：格式对了但没转义引号 vs 完全乱码）。
    *   *Verdict:* 可行，但评分系统需要分级：`Perfect` (JSON.parse), `Dirty` (Regex extraction), `Trash` (Failed).

### Logic Traps (逻辑陷阱)
*   **Context Limit:** 浏览器内模型通常 Context Window 较小（4k-8k）。陷阱设计必须精简。
*   **Quantization Loss:** 量化不仅损失知识，更损失逻辑。逻辑陷阱可能会导致模型产生严重的幻觉（Hallucinations）。这是 Feature，不是 Bug。
*   **Implementation:** 仅仅是 Prompt Engineering 的变种。不需要特殊技术栈。

## 2. Implementation Path (实现路径)

### Tech Stack Selection
*   **Framework:** **Vue 3 + Vite**. 理由：更轻量，Reactivity 系统适合实时渲染 Token 流。React 虽然生态好，但对于这种纯单页工具应用，Vue 的模板语法写 Prompt 界面更直观。
*   **Inference Engine:** **WebLLM (MLC-LLM)**. 目前最成熟的 WebGPU 方案。备选：Transformers.js (对于极小模型，但 WebLLM 针对 LLM 优化更好)。
*   **State Management:** Pinia. 需要管理庞大的模型加载状态（Loading weights -> caching -> warm up）。

### JSON Straitjacket Module Design
*   **Input:** 动态生成的 JSON Schema。
*   **Prompt:** "You are a JSON generator. Strictly follow this schema: [SCHEMA]. Output NOTHING else."
*   **Validation:** 使用 `ajv` (Another JSON Schema Validator) 在前端直接校验输出。
*   **Levels:**
    1.  **Level 1 (Warm-up):** Simple key-value. `{"status": "ok"}`.
    2.  **Level 5 (Recursive):** Nested objects.
    3.  **Level 10 (Hell):** Mixed types, arrays of objects, specific constraints (e.g., "string length < 10").

### Logic Traps Module Design
*   **Format:** Multiple Choice (A/B/C) to make automated judging easier.
*   **Trap Type - "The False Premise":** "Given that the sun orbits the earth, explain why..." -> Judge checks if model corrects the premise.

## 3. Evolution (演进与取舍)

*   **New Idea: "The Gaslighter" (煤气灯测试)**
    *   在模型回答正确后，System 自动追加一轮对话：“Are you sure? I think you missed the calculation in step 2.”
    *   测试模型的自信度（Confidence）。很多 RLHF 过的模型会立刻道歉并改错。这是一个绝佳的测试点。
*   **New Idea: "Local RAG Stress"**
    *   让用户上传一个 TXT，然后在浏览器内做简单的 Vector Search (using `vector storage` in IndexedDB)。测试 WebGPU 在 Embedding + Generation 切换时的显存压力。
*   **Cut Idea: "Code Execution Sandbox"**
    *   *Reason:* 原计划的“代码找茬”如果涉及运行代码，在浏览器端实现安全的沙箱（WebAssembly/Pyodide）太重了，且容易让页面崩溃。初期砍掉，改为纯静态代码分析（Linting output）。

## 4. Next Steps
1.  Initialize Vue 3 project structure.
2.  Build a minimal "JSON Validator" component utilizing `ajv`.
3.  Draft the first 5 "Gaslighter" prompts.
